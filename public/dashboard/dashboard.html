<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SportReg Realtime</title>
    <link rel="stylesheet" href="dashboard.css">
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<!-- Thêm class "role-admin" hoặc "role-athlete" vào body để giả lập quyền -->
<body>

    <!-- Checkbox ẩn để xử lý toggle menu trên mobile -->
    <input type="checkbox" id="nav-toggle">

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-brand">
            <h2><i class='bx bx-run'></i> <span>SportReg</span></h2>
        </div>

        <div class="sidebar-menu">
            <ul>
                <li>
                    <a href="/dashboard/dashboard.html" class="active"><i class='bx bx-grid-alt'></i> <span>Dashboard</span></a>
                </li>
                <li>
                    <a href="/tournaments/tournaments.html"><i class='bx bx-trophy'></i> <span>Giải đấu</span></a>
                </li>
                <li>
                    <a href="#"><i class='bx bx-edit'></i> <span>Đăng ký</span></a>
                </li>
                <li>
                    <a href="/live-status/live-status.html"><i class='bx bx-pulse'></i> <span>Trạng thái Realtime</span></a>
                </li>
                <li class="menu-users">
                    <a href="/user/users.html"><i class='bx bx-user'></i> <span>Người dùng</span></a>
                </li>
                <li class="menu-settings">
                    <a href="/setting/settings.html"><i class='bx bx-cog'></i> <span>Cài đặt</span></a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <header>
            <h2>
                <label for="nav-toggle">
                    <i class='bx bx-menu'></i>
                </label>
                Dashboard
            </h2>

            <div class="user-wrapper">
                <img src="https://ui-avatars.com/api/?name=Admin+User&background=random" width="40px" height="40px" alt="Avatar">
                <div>
                    <h4>Admin User</h4>
                    <small>Quản trị viên</small>
                </div>
                <div class="logout-icon" style="cursor: pointer;">
                    <i class='bx bx-log-out-circle'></i>
                </div>
            </div>
        </header>

        <main>
            <!-- Cards Thống kê -->
            <div class="cards">
                <div class="card-single">
                    <div>
                        <h1>54</h1>
                        <span>Tổng giải đấu</span>
                    </div>
                    <div><i class='bx bx-trophy'></i></div>
                </div>
                <div class="card-single">
                    <div>
                        <h1>12</h1>
                        <span>Đang diễn ra</span>
                    </div>
                    <div><i class='bx bx-time-five'></i></div>
                </div>
                <div class="card-single">
                    <div>
                        <h1>1,245</h1>
                        <span>Vận động viên</span>
                    </div>
                    <div><i class='bx bx-group'></i></div>
                </div>
                <div class="card-single">
                    <div>
                        <h1>Ổn định</h1>
                        <span>Hệ thống Realtime</span>
                    </div>
                    <div><i class='bx bx-pulse'></i></div>
                </div>
            </div>

            <!-- Bảng danh sách -->
            <div class="recent-grid">
                <div class="projects">
                    <div class="card">
                        <div class="card-header">
                            <h3>Giải đấu sắp diễn ra</h3>
                            <button>Xem tất cả <i class='bx bx-right-arrow-alt'></i></button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table width="100%">
                                    <thead>
                                        <tr>
                                            <td>Tên giải đấu</td>
                                            <td>Ngày bắt đầu</td>
                                            <td>Địa điểm</td>
                                            <td>Trạng thái</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Marathon Mùa Hè 2024</td>
                                            <td>15/06/2024</td>
                                            <td>Đà Nẵng</td>
                                            <td><span class="status green"></span> Mở đăng ký</td>
                                        </tr>
                                        <tr>
                                            <td>Giải Bơi Lội Quốc Gia</td>
                                            <td>20/07/2024</td>
                                            <td>Hà Nội</td>
                                            <td><span class="status orange"></span> Sắp mở</td>
                                        </tr>
                                        <tr>
                                            <td>Tennis Open Cup</td>
                                            <td>05/08/2024</td>
                                            <td>TP.HCM</td>
                                            <td><span class="status orange"></span> Sắp mở</td>
                                        </tr>
                                        <tr>
                                            <td>Giải Bóng Đá U19</td>
                                            <td>12/08/2024</td>
                                            <td>Bình Dương</td>
                                            <td><span class="status red"></span> Đóng</td>
                                        </tr>
                                        <tr>
                                            <td>Cầu Lông Mở Rộng</td>
                                            <td>22/08/2024</td>
                                            <td>Cần Thơ</td>
                                            <td><span class="status green"></span> Mở đăng ký</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;"></div>

    <!-- Socket.io Script -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // 1. Lấy thông tin user hiện tại
        const currentUserStr = localStorage.getItem('currentUser');
        if (currentUserStr) {
            const user = JSON.parse(currentUserStr);
            
            // 2. Gửi sự kiện join_room để đăng ký nhận tin
            socket.emit('join_room', user.id);

            // 3. Lắng nghe thông báo mới
            socket.on('new_notification', (data) => {
                showToast(data.title, data.message);
                
                // (Tùy chọn) Phát âm thanh thông báo
                // const audio = new Audio('/path/to/sound.mp3');
                // audio.play();
            });
        }

        // Hàm hiển thị Toast
        function showToast(title, message) {
            const container = document.getElementById('toast-container');
            
            const toast = document.createElement('div');
            toast.style.cssText = `
                background: #fff;
                border-left: 4px solid #2563eb;
                padding: 15px 20px;
                margin-top: 10px;
                border-radius: 4px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                min-width: 300px;
                animation: slideIn 0.3s ease-out forwards;
                display: flex;
                flex-direction: column;
            `;
            
            toast.innerHTML = `
                <strong style="color: #1e293b; margin-bottom: 5px;">${title}</strong>
                <span style="color: #64748b; font-size: 0.9rem;">${message}</span>
            `;

            container.appendChild(toast);

            // Tự động ẩn sau 5 giây
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                toast.style.transition = 'all 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }
    </script>
    <!-- Script Phân quyền & Bảo mật -->
    <script src="/js/auth.js"></script>
    <!-- Script Common (Logic chung) -->
    <script src="/js/common.js"></script>
</body>
</html>